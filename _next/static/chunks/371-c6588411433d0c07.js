"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{62869:function(e,a,r){r.d(a,{d:function(){return s},z:function(){return l}});var i=r(57437);r(2265);var n=r(37053),t=r(90535),o=r(94508);let s=(0,t.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:a,variant:r,size:t,asChild:l=!1,...c}=e,u=l?n.g7:"button";return(0,i.jsx)(u,{"data-slot":"button",className:(0,o.cn)(s({variant:r,size:t,className:a})),...c})}},16023:function(e,a,r){r.d(a,{a:function(){return s}});var i=r(2141),n=r(94967),t=r(73708),o=r(6943);let s=(0,t.U)()((0,o.tJ)(e=>({user:null,loading:!0,setUser:a=>e({user:a}),setLoading:a=>e({loading:a}),login:async(a,r)=>{try{let{data:t,error:o}=await i.O.auth.signInWithPassword({email:a,password:r});if(o)return{error:o.message};if(t.user)try{let r=await n.a.getUserByEmail(t.user.email||a);if(!r)return await i.O.auth.signOut(),{error:"Foydalanuvchi topilmadi yoki o'chirilgan"};return e({user:{id:t.user.id,email:t.user.email||a,role:r.role}}),{error:null}}catch(e){return await i.O.auth.signOut(),{error:"Foydalanuvchi ma'lumotlarini olishda xatolik"}}return{error:"Login failed"}}catch(e){return{error:e.message||"Login failed"}}},logout:async()=>{try{await i.O.auth.signOut(),e({user:null})}catch(e){console.error("Logout error:",e)}},checkAuth:async()=>{try{var a,r;let t=null===(r=JSON.parse(localStorage.getItem("auth-storage")||"{}"))||void 0===r?void 0:null===(a=r.state)||void 0===a?void 0:a.user;e({loading:!0});let{data:{user:o},error:s}=await i.O.auth.getUser();if(s||!o){e({user:null,loading:!1});return}if(t&&t.email===o.email&&t.role){e({user:{id:o.id,email:o.email||"",role:t.role},loading:!1});return}try{let a=await n.a.getUserByEmail(o.email||"");if(!a){console.log("Foydalanuvchi ".concat(o.email," users jadvalida topilmadi, logout qilinmoqda")),await i.O.auth.signOut(),e({user:null,loading:!1});return}e({user:{id:o.id,email:o.email||"",role:a.role},loading:!1})}catch(a){console.error("Auth check error:",a),await i.O.auth.signOut(),e({user:null,loading:!1})}}catch(a){console.error("Auth check error:",a),e({user:null,loading:!1})}}}),{name:"auth-storage",storage:(0,o.FL)(()=>localStorage),partialize:e=>({user:e.user})}))},42558:function(e,a,r){function i(e){if(!e)return{canViewIntegrations:!1,canCreateIntegrations:!1,canEditIntegrations:!1,canDeleteIntegrations:!1,canViewAudit:!1,canViewUsers:!1,canManageUsers:!1,canViewSettings:!1,canManageSettings:!1,canViewAnalytics:!1};switch(e){case"Administrator":return{canViewIntegrations:!0,canCreateIntegrations:!0,canEditIntegrations:!0,canDeleteIntegrations:!0,canViewAudit:!0,canViewUsers:!0,canManageUsers:!0,canViewSettings:!0,canManageSettings:!0,canViewAnalytics:!0};case"Operator":return{canViewIntegrations:!0,canCreateIntegrations:!0,canEditIntegrations:!0,canDeleteIntegrations:!1,canViewAudit:!0,canViewUsers:!1,canManageUsers:!1,canViewSettings:!1,canManageSettings:!1,canViewAnalytics:!0};case"Viewer":return{canViewIntegrations:!0,canCreateIntegrations:!1,canEditIntegrations:!1,canDeleteIntegrations:!1,canViewAudit:!0,canViewUsers:!1,canManageUsers:!1,canViewSettings:!1,canManageSettings:!1,canViewAnalytics:!0};default:return{canViewIntegrations:!1,canCreateIntegrations:!1,canEditIntegrations:!1,canDeleteIntegrations:!1,canViewAudit:!1,canViewUsers:!1,canManageUsers:!1,canViewSettings:!1,canManageSettings:!1,canViewAnalytics:!1}}}function n(e,a){return i(e)[a]}r.d(a,{Fs:function(){return n},ai:function(){return i}})},2141:function(e,a,r){r.d(a,{O:function(){return o}});var i=r(71545);let n="https://ssysxmsqtxsqshznupmw.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzeXN4bXNxdHhzcXNoem51cG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNDI1MDUsImV4cCI6MjA3NzcxODUwNX0.DW8LU5htQmahNXLYN0Y5fdyyAjCK7UfLXPs03n0O-ME";n&&t||console.warn("Supabase URL yoki Anon Key topilmadi. Iltimos, .env.local faylida NEXT_PUBLIC_SUPABASE_URL va NEXT_PUBLIC_SUPABASE_ANON_KEY qo'shing.");let o=(0,i.eI)(n,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})},94967:function(e,a,r){r.d(a,{a:function(){return t}});var i=r(2141);function n(e){return{id:e.id,name:e.name,email:e.email,role:e.role}}let t={getUsers:async()=>{try{let{data:e,error:a}=await i.O.from("users").select("*").order("created_at",{ascending:!1});if(a)throw a;return(e||[]).map(n)}catch(e){throw console.error("Foydalanuvchilarni olishda xatolik:",e),e}},getUser:async e=>{try{let{data:a,error:r}=await i.O.from("users").select("*").eq("id",e).single();if(r)throw r;return a?n(a):null}catch(e){throw console.error("Foydalanuvchini olishda xatolik:",e),e}},getUserByEmail:async e=>{try{let{data:a,error:r}=await i.O.from("users").select("*").eq("email",e).maybeSingle();if(r){if("PGRST116"===r.code)return null;throw r}return a?n(a):null}catch(r){var a;if((null==r?void 0:r.code)==="PGRST116"||(null==r?void 0:null===(a=r.message)||void 0===a?void 0:a.includes("0 rows")))return console.log("Foydalanuvchi ".concat(e," users jadvalida topilmadi")),null;return console.error("Foydalanuvchini email orqali olishda xatolik:",r),null}},addUser:async e=>{try{var a,r,t,o,s,l,c;let{data:u,error:d}=await (null===(a=i.O.auth.admin)||void 0===a?void 0:a.createUser({email:e.email,password:e.password,email_confirm:!0}));if(d){if((null===(r=d.message)||void 0===r?void 0:r.includes("already registered"))||(null===(t=d.message)||void 0===t?void 0:t.includes("already exists"))||(null===(o=d.message)||void 0===o?void 0:o.includes("User already registered")))throw Error("Bu email bilan foydalanuvchi allaqachon mavjud");let{data:a,error:u}=await i.O.auth.signUp({email:e.email,password:e.password});if(u){if((null===(s=u.message)||void 0===s?void 0:s.includes("already registered"))||(null===(l=u.message)||void 0===l?void 0:l.includes("already exists"))||(null===(c=u.message)||void 0===c?void 0:c.includes("User already registered")))throw Error("Bu email bilan foydalanuvchi allaqachon mavjud");throw u}if(!a.user)throw Error("Foydalanuvchi yaratilmadi");let{data:g,error:h}=await i.O.from("users").insert({id:a.user.id,name:e.name,email:e.email,role:e.role,is_active:!0}).select().single();if(h)throw h;return n(g)}if(!u.user)throw Error("Foydalanuvchi yaratilmadi");let{data:g,error:h}=await i.O.from("users").insert({id:u.user.id,name:e.name,email:e.email,role:e.role,is_active:!0}).select().single();if(h)throw h;return n(g)}catch(e){throw console.error("Foydalanuvchi qo'shishda xatolik:",e),e}},updateUser:async(e,a)=>{try{let r={};void 0!==a.name&&(r.name=a.name),void 0!==a.email&&(r.email=a.email),void 0!==a.role&&(r.role=a.role),r.updated_at=new Date().toISOString();let{data:t,error:o}=await i.O.from("users").update(r).eq("id",e).select().single();if(o)throw o;return t?n(t):null}catch(e){throw console.error("Foydalanuvchini yangilashda xatolik:",e),e}},updateUserPassword:async(e,a)=>{try{var r;let{error:n}=await (null===(r=i.O.auth.admin)||void 0===r?void 0:r.updateUserById(e,{password:a}));if(n)return console.warn("Admin API mavjud emas. Parol yangilash uchun Edge Function ishlatilishi kerak."),!1;return!0}catch(e){return console.error("Parolni yangilashda xatolik:",e),!1}},deleteUser:async e=>{try{try{var a;let{error:r}=await (null===(a=i.O.auth.admin)||void 0===a?void 0:a.deleteUser(e));r&&console.warn("Auth'dan o'chirishda xatolik:",r)}catch(e){console.warn("Auth admin API mavjud emas yoki xatolik:",e)}let{error:r}=await i.O.from("users").delete().eq("id",e);if(r)throw r;return!0}catch(e){throw console.error("Foydalanuvchini o'chirishda xatolik:",e),e}}}},94508:function(e,a,r){r.d(a,{cn:function(){return t},p:function(){return o}});var i=r(61994),n=r(53335);function t(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,n.m6)((0,i.W)(a))}function o(e){return new Date(e).toLocaleDateString("en-CA",{year:"numeric",month:"2-digit",day:"2-digit"})}}}]);